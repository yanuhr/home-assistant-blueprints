blueprint:
  name: Monitorovanie stavu smart zÃ¡mkov
  description: >
    Sleduje zmeny stavu zÃ¡mkov (napr. SwitchBot Lock Pro) a posiela notifikÃ¡cie pri odomknutÃ­,
    zamknutÃ­, zaseknutÃ­ alebo inÃ½ch stavoch. Podporuje viacero zÃ¡mkov a notifikaÄnÃ½ch sluÅ¾ieb.
  domain: automation
  input:
    lock_entities:
      name: ZÃ¡mky
      description: Vyberte zÃ¡mky, ktorÃ© chcete monitorovaÅ¥
      selector:
        entity:
          domain: lock
          multiple: true

    notification_services:
      name: NotifikaÄnÃ© sluÅ¾by
      description: Zadajte nÃ¡zvy notifikaÄnÃ½ch sluÅ¾ieb (napr. notify.mobile_app_iphone_jan)
      default: []
      selector:
        text:
          multiple: true

trigger:
  - platform: state
    entity_id: !input lock_entities

condition: []

action:
  - variables:
      lock_entity: "{{ trigger.entity_id }}"
      new_state: "{{ trigger.to_state.state | lower }}"
      lock_name: "{{ state_attr(lock_entity, 'friendly_name') | default(lock_entity) }}"
      lock_location: "{{ area_name(lock_entity) | default(lock_name) }}"
      notification_services: !input notification_services
      message_text: >-
        {% set state_map = {
          'locked': 'bol zamknutÃ½ ğŸ”’',
          'unlocked': 'bol odomknutÃ½ ğŸ”“',
          'jammed': 'je ZASEKNUTÃ â€¼ï¸. PotrebnÃ¡ rekalibrÃ¡cia!',
          'locking': 'sa prÃ¡ve zamykÃ¡ â³',
          'unlocking': 'sa prÃ¡ve odomykÃ¡ â³',
          'unknown': 'je v neznÃ¡mom stave â“'
        } %}
        {% set status = state_map.get(new_state, 'je v stave: ' ~ new_state ~ ' â“') %}
        {% if lock_name == lock_location %}
          ZÃ¡mok {{ lock_name }} {{ status }}
        {% else %}
          ZÃ¡mok {{ lock_name }} v miestnosti {{ lock_location }} {{ status }}
        {% endif %}

  - if:
      - condition: template
        value_template: "{{ notification_services | length > 0 and new_state != 'unknown' }}"
    then:
      - repeat:
          for_each: "{{ notification_services }}"
          sequence:
            - service: "{{ repeat.item }}"
              data:
                title: "ğŸ” Stav zÃ¡mku"
                message: "{{ message_text }}"

mode: single
