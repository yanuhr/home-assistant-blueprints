blueprint:
  name: Sledovanie batÃ©riÃ­ s dennÃ½m upozornenÃ­m
  description: Odosiela notifikÃ¡ciu, ak batÃ©ria klesne pod 15 % a pripomÃ­na denne.
  domain: automation
  input:
    monitored_batteries:
      name: SledovanÃ© batÃ©rie
      description: Vyber entity, ktorÃ© predstavujÃº ÃºroveÅˆ batÃ©rie (%)
      selector:
        entity:
          domain: sensor
          multiple: true
    notification_service:
      name: NotifikaÄnÃ¡ sluÅ¾ba
      description: Vyber sluÅ¾bu, ktorou sa mÃ¡ poslaÅ¥ upozornenie
      selector:
        service: {}
    check_time:
      name: ÄŒas kontroly
      description: Kedy sa mÃ¡ vykonaÅ¥ kontrola stavu batÃ©riÃ­
      default: "08:00:00"
      selector:
        time: {}

mode: parallel
max_exceeded: silent

variables:
  batteries: !input monitored_batteries
  notify_service: !input notification_service
  low_threshold: 15

trigger:
  - platform: time
    at: !input check_time

condition: []

action:
  - repeat:
      for_each: "{{ batteries }}"
      sequence:
        - variables:
            battery_entity: "{{ repeat.item }}"
            battery_level: "{{ states(battery_entity) | float(default=100) }}"
        - if:
            - condition: numeric_state
              entity_id: "{{ battery_entity }}"
              below: "{{ low_threshold }}"
          then:
            - service: "{{ notify_service }}"
              data:
                message: >
                  ğŸ”‹ NÃ­zka batÃ©ria: {{ state_attr(battery_entity, 'friendly_name') or battery_entity }}
                  mÃ¡ iba {{ battery_level | int }} %!
                title: "Upozornenie na batÃ©riu"
