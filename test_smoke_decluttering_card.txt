test_smoke_detector_card:
  card:
    type: custom:mushroom-template-card
    primary: "{{ state_attr(entity_id, 'friendly_name') }}"
    secondary: >
      {% set s = states(entity_id) %}
      {% if s == 'on' %}
        🚨 Zadymenie
      {% elif s in ['unavailable', 'unknown'] %}
        ❌ Offline
      {% else %}
        ✅ OK / online
      {% endif %}
    icon: mdi:smoke-detector
    icon_color: >
      {% if is_state(entity_id, 'on') %} red
      {% elif is_state(entity_id, 'unavailable') or is_state(entity_id, 'unknown') %} grey
      {% else %} green
      {% endif %}
    badge_icon: mdi:check-circle-outline
    badge_color: >
      {% if is_state(test_result, 'NOK') %} red
      {% else %} green
      {% endif %}
    multiline_secondary: true
    tap_action:
      action: call-service
      service: event.fire
      data:
        event_type: test_smoke_alert
        event_data:
          entity_id: '[[entity_id]]'
    layout: horizontal
    fill_container: true
    footer:
      type: custom:mushroom-template-card
      primary: >
        🕒 Test: {{ states(test_time) | default('nikdy') }}
      secondary: >
        Stav: {{ states(test_result) | default('nezistené') }}
      icon: mdi:clipboard-check-outline
      icon_color: grey
      fill_container: true
